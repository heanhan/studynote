volatile 与 JMM 关系

volatile 主要是解决多线程下线程的可见性问题，因为相对于 cpu 来讲，访问内存相较于是慢的，因此 cpu 增加了缓存来均衡与内存的差异，结果就是会导致多 cpu 场景下，每个 cpu 会将数据缓存起来，对共享数据操作时，每隔 cpu 会操作自己缓存中的数据，然后就会出现并发问题，使用 volatile 来修饰变量，就是让 cpu 每次从访问共享变量时从内存中去获取。

补充：

```
JMM 只是一个虚拟的 java 内存模型概念，经过编译后会加上读写屏障，保证顺序性，可见性是 JVM 指令前端的 lock 指令保证的，lock 是符合缓存一致性协议的，有 lock前端指令会将工作区内的共享变量强制立即刷新主内存并且使得所有的 cpu 中缓存行数据失效。保证在下一个 cpu时间段拿到的最新的共享变量。
```

